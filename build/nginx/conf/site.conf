
upstream api_server {
  server core:9000;
}

upstream preview_server {
  server preview:9000;
}

upstream static_server {
  server static:9000;
}

upstream register_server {
  server register:9000;
}

# Registry
server {
  listen               443;
  server_name          reg.rec.la;
  access_log /app/log/reg.access.log;
  
  ssl                  on;

  keepalive_timeout    70;
  client_max_body_size 20M;

  location / {
    proxy_pass http://register_server;
  
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header  Host $http_host;
    proxy_set_header  X-Forwarded-Proto https;
    proxy_redirect    off;
  }
}

# Static Web
server {
  listen               443;
  server_name          sw.rec.la;
  access_log /app/log/sw.access.log;
  
  ssl                  on;

  keepalive_timeout    70;
  client_max_body_size 20M;

  location / {
    proxy_pass http://static_server;
  
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header  Host $http_host;
    proxy_set_header  X-Forwarded-Proto https;
    proxy_redirect    off;
  }
}

# API (Core)
server {
  listen               443;
  server_name          *.rec.la;
  access_log  /app/log/api.access.log;

  ssl                  on;

  keepalive_timeout    70;
  client_max_body_size 20M;
}
