#!/usr/bin/env bash

set -e

# Builds an up to date version of 'pryv/base', image layer that sits below 
# all of pryv's docker images. 

version=$(git describe)

echo "---------------------------- building base -------------------------------"
pushd base
sudo docker build -f Dockerfile -t pryv/base:$version .
sudo docker tag pryv/base:$version pryv/base:latest
popd

echo "---------------------------- building mongodb ----------------------------"
pushd mongodb
sudo docker build -f Dockerfile -t pryv/mongodb:$version .
sudo docker tag pryv/mongodb:$version pryv/mongodb:latest
popd

echo "---------------------------- building redis ------------------------------"
pushd redis
sudo docker build -f Dockerfile -t pryv/redis:$version .
sudo docker tag pryv/redis:$version pryv/redis:latest
popd

echo "---------------------------- building nginx ------------------------------"
pushd nginx
sudo docker build -f Dockerfile -t pryv/nginx:$version .
sudo docker tag pryv/nginx:$version pryv/nginx:latest
popd
