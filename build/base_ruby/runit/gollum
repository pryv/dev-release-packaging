#!/bin/sh

set -e

bin_dir="/app/bin"
data_dir="/app/data"
log_dir="/app/log"
conf_dir="/app/conf"

cd $data_dir
if [[ ! -d .git ]]; then
  git init
fi

chown -R app:app $data_dir
chown -R app:app $log_dir

cd $bin_dir
exec chpst -u app /usr/local/bin/bundle exec gollum --config $conf_dir/config.rb \
  --port 9000 2>&1 >> $log_dir/gollum.log 
